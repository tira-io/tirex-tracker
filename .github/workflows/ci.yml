name: CI

on:
  push:

permissions: {}

concurrency:
  group: ${{ github.actor }}-${{ github.workflow }}-${{ github.event_name }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  c-build-library:
    name: ğŸ—ï¸ Build C library
    strategy:
      fail-fast: false
      matrix:
        environment:
          - runs-on: ubuntu-22.04
            compiler: gcc-13
          - runs-on: ubuntu-24.04
            compiler: gcc-14
          - runs-on: macos-14
            compiler: gcc-14
          - runs-on: macos-15
            compiler: gcc-14
          # - runs-on: windows-2019
          #   compiler: gcc-14
          # - runs-on: windows-2022
          #   compiler: gcc-14
          # - runs-on: windows-2025
          #   compiler: gcc-14
    runs-on: ${{ matrix.environment.runs-on }}
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ§° Install compiler
        uses: aminya/setup-cpp@v1
        with:
          compiler: ${{ matrix.environment.compiler }}
          cmake: "3.24.0"
          setup-cpp: false
      - name: ğŸ”§ Configure CMake
        run: cmake -S c/ -B c/build/ -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_COMPILER=${{ env.CC }} -DCMAKE_CXX_COMPILER=${{ env.CXX }}
      - name: ğŸ—ï¸ Build library
        run: cmake --build c/build/ --config Release --target tirex_tracker_full
      - name: ğŸ“¤ Upload macOS library
        if: matrix.environment.runs-on == 'macos-14'
        uses: actions/upload-artifact@v4
        with:
          name: c-library-macos
          path: c/build/extensions/libtirex_tracker_full.dylib
      - name: ğŸ“¤ Upload Windows library
        if: matrix.environment.runs-on == 'windows-2022'
        uses: actions/upload-artifact@v4
        with:
          name: c-library-windows
          path: c/build/extensions/libtirex_tracker_full.dll
  c-build-library-legacy:
    name: ğŸ—ï¸ Build C library (legacy)
    strategy:
      fail-fast: false
      matrix:
        environment:
          # - runs-on: ubuntu-16.04
          #   compiler: gcc-5
          - runs-on: ubuntu-18.04
            compiler: gcc-8
          - runs-on: ubuntu-20.04
            compiler: gcc-9
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ§° Prepare runner image
        uses: docker/build-push-action@v6
        with:
          context: .github/workflows/
          target: ${{ matrix.environment.runs-on }}-${{ matrix.environment.compiler }}
          tags: runner
          load: true
      - name: ğŸ”§ Configure CMake
        run: |
          docker run --volume ${{ github.workspace }}:/workspace --workdir /workspace runner \
          cmake -S c/ -B c/build/ -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_COMPILER=$CC -DCMAKE_CXX_COMPILER=$CXX
      - name: ğŸ—ï¸ Build library
        run: |
          docker run --volume ${{ github.workspace }}:/workspace --workdir /workspace runner \
          cmake --build c/build/ --config Release --target tirex_tracker_full
      - name: ğŸ“¤ Upload Linux library
        if: matrix.environment.runs-on == 'ubuntu-20.04'
        uses: actions/upload-artifact@v4
        with:
          name: c-library-linux
          path: c/build/extensions/libtirex_tracker_full.so
  c-check-format:
    name: ğŸ” Check C code format
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ§° Install compiler
        uses: aminya/setup-cpp@v1
        with:
          clang-format: "19.1.0"
          setup-cpp: false
      - name: ğŸ” Check Codestyle
        run: |
          find c/ -type f -iregex '^.*\.\(c\|h\|cpp\|hpp\|cc\|hh\)$' | \
          xargs git ls-files | \
          xargs clang-format-19 --dry-run --Werror --Wno-error=unknown
  c-build-cli:
    name: ğŸ—ï¸ Build C CLI
    strategy:
      fail-fast: false
      matrix:
        environment:
          - runs-on: ubuntu-22.04
            compiler: gcc-13
          - runs-on: ubuntu-24.04
            compiler: gcc-14
          - runs-on: macos-14
            compiler: gcc-14
          - runs-on: macos-15
            compiler: gcc-14
          # - runs-on: windows-2019
          #   compiler: gcc-14
          # - runs-on: windows-2022
          #   compiler: gcc-14
          # - runs-on: windows-2025
          #   compiler: gcc-14
    runs-on: ${{ matrix.environment.runs-on }}
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ§° Install compiler
        uses: aminya/setup-cpp@v1
        with:
          compiler: ${{ matrix.environment.compiler }}
          cmake: "3.24.0"
          setup-cpp: false
      - name: ğŸ”§ Configure CMake
        run: |
          cmake -S c/ -B c/build/ -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_COMPILER=${{ env.CC }} -DCMAKE_CXX_COMPILER=${{ env.CXX }} -D TIREX_TRACKER_BUILD_CLI=YES
      - name: ğŸ—ï¸ Build CLI
        run: cmake --build c/build/ --config Release --target tirex_tracker_cli
      - name: ğŸ“¤ Upload macOS CLI
        if: matrix.environment.runs-on == 'macos-14'
        uses: actions/upload-artifact@v4
        with:
          name: c-cli-macos
          path: c/build/cli/tirex-tracker-*-Darwin-*
      - name: ğŸ“¤ Upload Windows CLI
        if: matrix.environment.runs-on == 'windows-2022'
        uses: actions/upload-artifact@v4
        with:
          name: c-cli-windows
          path: c/build/cli/Release/tirex-tracker-*-Windows-*.exe
  c-build-cli-legacy:
    name: ğŸ—ï¸ Build C CLI (legacy)
    strategy:
      fail-fast: false
      matrix:
        environment:
          # - runs-on: ubuntu-16.04
          #   compiler: gcc-5
          - runs-on: ubuntu-18.04
            compiler: gcc-8
          - runs-on: ubuntu-20.04
            compiler: gcc-9
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ§° Prepare runner image
        uses: docker/build-push-action@v6
        with:
          context: .github/workflows/
          target: ${{ matrix.environment.runs-on }}-${{ matrix.environment.compiler }}
          tags: runner
          load: true
      - name: ğŸ”§ Configure CMake
        run: |
          docker run --volume ${{ github.workspace }}:/workspace --workdir /workspace runner \
          cmake -S c/ -B c/build/ -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_COMPILER=$CC -DCMAKE_CXX_COMPILER=$CXX -D TIREX_TRACKER_BUILD_CLI=YES
      - name: ğŸ—ï¸ Build CLI
        run: |
          docker run --volume ${{ github.workspace }}:/workspace --workdir /workspace runner \
          cmake --build c/build/ --config Release --target tirex_tracker_cli
      - name: ğŸ“¤ Upload Linux CLI
        if: matrix.environment.runs-on == 'ubuntu-20.04'
        uses: actions/upload-artifact@v4
        with:
          name: c-cli-linux
          path: c/build/cli/tirex-tracker-*-Linux-*
  c-build-debian-package:
    name: ğŸ—ï¸ Build Debian package
    strategy:
      fail-fast: false
      matrix:
        environment:
          - runs-on: ubuntu-22.04
            compiler: gcc-13
          - runs-on: ubuntu-24.04
            compiler: gcc-14
    runs-on: ${{ matrix.environment.runs-on }}
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ§° Install compiler
        uses: aminya/setup-cpp@v1
        with:
          compiler: ${{ matrix.environment.compiler }}
          cmake: "3.24.0"
          setup-cpp: false
      - name: ğŸ”§ Configure CMake
        run: |
          cmake -S c/ -B c/build/ -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_COMPILER=${{ env.CC }} -DCMAKE_CXX_COMPILER=${{ env.CXX }} -D TIREX_TRACKER_BUILD_CLI=YES -D TIREX_TRACKER_BUILD_DEB=YES
      - name: ğŸ—ï¸ Build Debian package
        run: cmake --build c/build/ --config Release --target package
  c-build-debian-package-legacy:
    name: ğŸ—ï¸ Build Debian package (legacy)
    strategy:
      fail-fast: false
      matrix:
        environment:
          # - runs-on: ubuntu-16.04
          #   compiler: gcc-5
          - runs-on: ubuntu-18.04
            compiler: gcc-8
          - runs-on: ubuntu-20.04
            compiler: gcc-9
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ§° Prepare runner image
        uses: docker/build-push-action@v6
        with:
          context: .github/workflows/
          target: ${{ matrix.environment.runs-on }}-${{ matrix.environment.compiler }}
          tags: runner
          load: true
      - name: ğŸ”§ Configure CMake
        run: |
          docker run --volume ${{ github.workspace }}:/workspace --workdir /workspace runner \
          cmake -S c/ -B c/build/ -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_COMPILER=$CC -DCMAKE_CXX_COMPILER=$CXX -D TIREX_TRACKER_BUILD_CLI=YES -D TIREX_TRACKER_BUILD_DEB=YES
      - name: ğŸ—ï¸ Build Debian package
        run: |
          docker run --volume ${{ github.workspace }}:/workspace --workdir /workspace runner \
          cmake --build c/build/ --config Release --target package
      - name: ğŸ“¤ Upload Debian package
        if: matrix.environment.runs-on == 'ubuntu-20.04'
        uses: actions/upload-artifact@v4
        with:
          name: c-debian-package
          path: c/build/tirex-tracker-*-Linux.deb
  jvm-build:
    name: ğŸ—ï¸ Build JVM library
    strategy:
      fail-fast: false
      matrix:
        java: # Java LTS versions
          - "8"
          - "11"
          - "17"
          - "21"
    runs-on: ubuntu-latest
    needs:
      - c-build-library
      - c-build-library-legacy
      - c-check-format
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ§° Install JDK 8 (for compiling)
        uses: actions/setup-java@v4
        with:
          java-version: 8
          distribution: temurin
          cache: gradle
          cache-dependency-path: |
            jvm/example/build.gradle.kts
            jvm/library/build.gradle.kts
      - name: ğŸ§° Install JDK (for checks)
        uses: actions/setup-java@v4
        with:
          java-version: ${{ matrix.java }}
          distribution: temurin
          cache: gradle
          cache-dependency-path: |
            jvm/example/build.gradle.kts
            jvm/library/build.gradle.kts
      - name: ğŸ“¥ Download Linux library
        uses: actions/download-artifact@v4
        with:
          name: c-library-linux
          path: jvm/library/src/main/resources/
      - name: ğŸ“¥ Download macOS library
        uses: actions/download-artifact@v4
        with:
          name: c-library-macos
          path: jvm/library/src/main/resources/
      # - name: ğŸ“¥ Download Windows library
      #   uses: actions/download-artifact@v4
      #   with:
      #     name: c-library-windows
      #     path: jvm/library/src/main/resources/
      - name: ğŸ—ï¸ Build project
        run: jvm/gradlew --project-dir jvm/ build
  jvm-check:
    name: ğŸ§ª Test and check JVM library
    strategy:
      fail-fast: false
      matrix:
        java: # Java LTS versions
          - "8"
          - "11"
          - "17"
          - "21"
        runs-on:
          - ubuntu-22.04
          - ubuntu-24.04
          # - macos-14
          # - macos-15
          # - windows-2019
          # - windows-2022
          # - windows-2025
        exclude:
          - java: "8"
            runs-on: windows-2019
          - java: "8"
            runs-on: windows-2022
          - java: "8"
            runs-on: windows-2025
          - java: "11"
            runs-on: windows-2019
          - java: "11"
            runs-on: windows-2022
          - java: "11"
            runs-on: windows-2025
          - java: "19"
            runs-on: windows-2019
          - java: "19"
            runs-on: windows-2022
          - java: "19"
            runs-on: windows-2025
          - java: "21"
            runs-on: windows-2019
          - java: "21"
            runs-on: windows-2022
          - java: "21"
            runs-on: windows-2025
    runs-on: ${{ matrix.runs-on }}
    needs:
      - c-build-library
      - c-build-library-legacy
      - c-check-format
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ§° Install JDK 8 (for compiling)
        uses: actions/setup-java@v4
        with:
          java-version: 8
          distribution: temurin
          cache: gradle
          cache-dependency-path: |
            jvm/example/build.gradle.kts
            jvm/library/build.gradle.kts
      - name: ğŸ§° Install JDK (for checks)
        uses: actions/setup-java@v4
        with:
          java-version: ${{ matrix.java }}
          distribution: temurin
          cache: gradle
          cache-dependency-path: |
            jvm/example/build.gradle.kts
            jvm/library/build.gradle.kts
      - name: ğŸ“¥ Download Linux library
        uses: actions/download-artifact@v4
        with:
          name: c-library-linux
          path: jvm/library/src/main/resources/
      - name: ğŸ“¥ Download macOS library
        uses: actions/download-artifact@v4
        with:
          name: c-library-macos
          path: jvm/library/src/main/resources/
      # - name: ğŸ“¥ Download Windows library
      #   uses: actions/download-artifact@v4
      #   with:
      #     name: c-library-windows
      #     path: jvm/library/src/main/resources/
      - name: ğŸ§ª Test and check with Gradle
        run: jvm/gradlew --project-dir jvm/ check
      - name: ğŸ“¤ Upload coverage to Codecov
        if: matrix.java == '21'
        uses: codecov/codecov-action@v5
        with:
          token: ${{ secrets.CODECOV_TOKEN }}
          files: jvm/library/build/reports/jacoco/test/jacocoTestReport.xml
  jvm-publish:
    name: ğŸš€ Publish JVM library
    permissions:
      packages: write
    strategy:
      fail-fast: false
      matrix:
        java: # Java LTS versions
          - "8"
          - "11"
          - "17"
          - "21"
    if: github.event_name == 'push' && endsWith(github.event.base_ref, 'master') && startsWith(github.ref, 'refs/tags')
    runs-on: ubuntu-latest
    needs:
      - c-build-library
      - c-build-library-legacy
      - c-check-format
      - jvm-build
      - jvm-check
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ§° Install JDK 8 (for compiling)
        uses: actions/setup-java@v4
        with:
          java-version: 8
          distribution: temurin
          cache: gradle
          cache-dependency-path: |
            jvm/example/build.gradle.kts
            jvm/library/build.gradle.kts
      - name: ğŸ§° Install JDK (for checks)
        uses: actions/setup-java@v4
        with:
          java-version: ${{ matrix.java }}
          distribution: temurin
          cache: gradle
          cache-dependency-path: |
            jvm/example/build.gradle.kts
            jvm/library/build.gradle.kts
      - name: ğŸ“¥ Download Linux library
        uses: actions/download-artifact@v4
        with:
          name: c-library-linux
          path: jvm/library/src/main/resources/
      - name: ğŸ“¥ Download macOS library
        uses: actions/download-artifact@v4
        with:
          name: c-library-macos
          path: jvm/library/src/main/resources/
      # - name: ğŸ“¥ Download Windows library
      #   uses: actions/download-artifact@v4
      #   with:
      #     name: c-library-windows
      #     path: jvm/library/src/main/resources/
      - name: ğŸš€ Publish JVM library to Maven Local
        run: jvm/gradlew --project-dir jvm/ publishToMavenLocal
      - name: ğŸ“¤ Upload JVM JAR
        if: matrix.java == '21'
        uses: actions/upload-artifact@v4
        with:
          name: jvm-jar
          path: ~/.m2/repository/io/tira/tirex-tracker/*/tirex-tracker-*.jar
      - name: ğŸ“¤ Upload JVM sources JAR
        if: matrix.java == '21'
        uses: actions/upload-artifact@v4
        with:
          name: jvm-sources-jar
          path: ~/.m2/repository/io/tira/tirex-tracker/*/tirex-tracker-*-sources.jar
      - name: ğŸ“¤ Upload JVM Javadoc JAR
        if: matrix.java == '21'
        uses: actions/upload-artifact@v4
        with:
          name: jvm-javadoc-jar
          path: ~/.m2/repository/io/tira/tirex-tracker/*/tirex-tracker-*-javadoc.jar
      - name: ğŸ“¤ Upload JVM HTML docs JAR
        if: matrix.java == '21'
        uses: actions/upload-artifact@v4
        with:
          name: jvm-html-docs-jar
          path: ~/.m2/repository/io/tira/tirex-tracker/*/tirex-tracker-*-html-docs.jar
      - name: ğŸš€ Publish JVM library to GitHub Packages
        if: matrix.java == '21'
        env:
          GITHUB_USERNAME: ${{ github.actor }}
          GITHUB_PASSWORD: ${{ secrets.GITHUB_TOKEN }}
        run: jvm/gradlew --project-dir jvm/ publishAllPublicationsToGitHubPackagesRepository
      - name: ğŸš€ Publish JVM library to Maven Central
        if: matrix.java == '21'
        env:
          JRELEASER_GPG_PASSPHRASE: ${{ secrets.GPG_PASSPHRASE }}
          JRELEASER_GPG_PUBLIC_KEY: ${{ secrets.GPG_PUBLIC_KEY }}
          JRELEASER_GPG_SECRET_KEY: ${{ secrets.GPG_SECRET_KEY }}
          JRELEASER_MAVENCENTRAL_USERNAME: ${{ secrets.MAVENCENTRAL_USERNAME }}
          JRELEASER_MAVENCENTRAL_PASSWORD: ${{ secrets.MAVENCENTRAL_PASSWORD }}
        run: jvm/gradlew --project-dir jvm/ jreleaserDeploy
  python-build:
    name: ğŸ—ï¸ Build Python wheels
    strategy:
      fail-fast: false
      matrix:
        python:
          # - "3.8"
          - "3.9"
          - "3.10"
          - "3.11"
          - "3.12"
          - "3.13"
    runs-on: ubuntu-latest
    needs:
      - c-build-library
      - c-build-library-legacy
      - c-check-format
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ§° Install Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python }}
      - name: ğŸ“¥ Download Linux library
        uses: actions/download-artifact@v4
        with:
          name: c-library-linux
          path: python/tirex_tracker/
      - name: ğŸ“¥ Download macOS library
        uses: actions/download-artifact@v4
        with:
          name: c-library-macos
          path: python/tirex_tracker/
      # - name: ğŸ“¥ Download Windows library
      #   uses: actions/download-artifact@v4
      #   with:
      #     name: c-library-windows
      #     path: python/tirex_tracker/
      - name: ğŸ§° Install dependencies
        run: pip install build twine
      - name: ğŸ—ï¸ Build Python wheels
        run: python -m build python
      - name: ğŸ§ª Check package bundles
        run: twine check python/dist/*
      - name: ğŸ“¤ Upload Python wheels
        if: matrix.python == '3.13'
        uses: actions/upload-artifact@v4
        with:
          name: python-wheels
          path: python/dist/
  python-check:
    name: ğŸ” Check Python code
    strategy:
      fail-fast: false
      matrix:
        python:
          - "3.8"
          - "3.9"
          - "3.10"
          - "3.11"
          - "3.12"
          - "3.13"
    runs-on: ubuntu-latest
    needs:
      - c-build-library
      - c-build-library-legacy
      - c-check-format
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ§° Install Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python }}
          cache: pip
          cache-dependency-path: python/pyproject.toml
      - name: ğŸ“¥ Download Linux library
        uses: actions/download-artifact@v4
        with:
          name: c-library-linux
          path: python/tirex_tracker/
      - name: ğŸ“¥ Download macOS library
        uses: actions/download-artifact@v4
        with:
          name: c-library-macos
          path: python/tirex_tracker/
      # - name: ğŸ“¥ Download Windows library
      #   uses: actions/download-artifact@v4
      #   with:
      #     name: c-library-windows
      #     path: python/tirex_tracker/
      - name: ğŸ§° Install dependencies
        run: pip install -e python[tests]
      - name: ğŸ” Check Python code
        run: ruff check python
  python-typing:
    name: ğŸ” Check Python static typing
    strategy:
      fail-fast: false
      matrix:
        python:
          - "3.8"
          - "3.9"
          - "3.10"
          - "3.11"
          - "3.12"
          - "3.13"
    runs-on: ubuntu-latest
    needs:
      - c-build-library
      - c-build-library-legacy
      - c-check-format
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ§° Install Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python }}
          cache: pip
          cache-dependency-path: python/pyproject.toml
      - name: ğŸ“¥ Download Linux library
        uses: actions/download-artifact@v4
        with:
          name: c-library-linux
          path: python/tirex_tracker/
      - name: ğŸ“¥ Download macOS library
        uses: actions/download-artifact@v4
        with:
          name: c-library-macos
          path: python/tirex_tracker/
      # - name: ğŸ“¥ Download Windows library
      #   uses: actions/download-artifact@v4
      #   with:
      #     name: c-library-windows
      #     path: python/tirex_tracker/
      - name: ğŸ§° Install dependencies
        run: pip install -e python[tests]
      - name: ğŸ” Check Python static typing
        run: mypy python
  python-security:
    name: ğŸ” Check Python code security
    strategy:
      fail-fast: false
      matrix:
        python:
          - "3.8"
          - "3.9"
          - "3.10"
          - "3.11"
          - "3.12"
          - "3.13"
    runs-on: ubuntu-latest
    needs:
      - c-build-library
      - c-build-library-legacy
      - c-check-format
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ§° Install Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python }}
          cache: pip
          cache-dependency-path: python/pyproject.toml
      - name: ğŸ“¥ Download Linux library
        uses: actions/download-artifact@v4
        with:
          name: c-library-linux
          path: python/tirex_tracker/
      - name: ğŸ“¥ Download macOS library
        uses: actions/download-artifact@v4
        with:
          name: c-library-macos
          path: python/tirex_tracker/
      # - name: ğŸ“¥ Download Windows library
      #   uses: actions/download-artifact@v4
      #   with:
      #     name: c-library-windows
      #     path: python/tirex_tracker/
      - name: ğŸ§° Install dependencies
        run: pip install -e python[tests]
      - name: ğŸ” Check Python code security
        run: bandit -c python/pyproject.toml -r python
  python-test:
    name: ğŸ§ª Test Python code
    strategy:
      fail-fast: false
      matrix:
        python:
          - "3.8"
          - "3.9"
          - "3.10"
          - "3.11"
          - "3.12"
          - "3.13"
        runs-on:
          - ubuntu-22.04
          - ubuntu-24.04
          - macos-14
          - macos-15
          # - windows-2019
          # - windows-2022
          # - windows-2025
    runs-on: ${{ matrix.runs-on }}
    needs:
      - c-build-library
      - c-build-library-legacy
      - c-check-format
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ§° Install Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python }}
          cache: pip
          cache-dependency-path: python/pyproject.toml
      - name: ğŸ“¥ Download Linux library
        uses: actions/download-artifact@v4
        with:
          name: c-library-linux
          path: python/tirex_tracker/
      - name: ğŸ“¥ Download macOS library
        uses: actions/download-artifact@v4
        with:
          name: c-library-macos
          path: python/tirex_tracker/
      # - name: ğŸ“¥ Download Windows library
      #   uses: actions/download-artifact@v4
      #   with:
      #     name: c-library-windows
      #     path: python/tirex_tracker/
      - name: ğŸ§° Install dependencies
        run: pip install -e python[tests]
      - name: ğŸ§ª Test Python code
        run: pytest --cov --cov-report xml python
      - name: ğŸ“¤ Upload coverage to Codecov
        if: matrix.python == '3.13'
        uses: codecov/codecov-action@v5
        with:
          token: ${{ secrets.CODECOV_TOKEN }}
          files: coverage.xml
  python-publish:
    name: ğŸš€ Publish Python wheels
    if: github.event_name == 'push' && endsWith(github.event.base_ref, 'master') && startsWith(github.ref, 'refs/tags')
    needs:
      - c-build-library
      - c-build-library-legacy
      - c-check-format
      - python-build
      - python-check
      - python-typing
      - python-security
      - python-test
    runs-on: ubuntu-latest
    permissions:
      id-token: write
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v4
      - name: ğŸ“¥ Download Python wheels
        uses: actions/download-artifact@v4
        with:
          name: python-wheels
          path: dist
      - name: ğŸš€ Publish Python wheels to PyPI
        uses: pypa/gh-action-pypi-publish@release/v1
  github-release:
    name: ğŸš€ Create GitHub release
    if: github.event_name == 'push' && endsWith(github.event.base_ref, 'master') && startsWith(github.ref, 'refs/tags')
    needs:
      - c-build-library
      - c-build-library-legacy
      - c-check-format
      - c-build-cli
      - c-build-cli-legacy
      - c-build-debian-package
      - c-build-debian-package-legacy
      - jvm-build
      - jvm-check
      - jvm-publish
      - python-build
      - python-check
      - python-typing
      - python-security
      - python-test
      - python-publish
    permissions:
      contents: write
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Check-out
        uses: actions/checkout@v3
      - name: ğŸ“¥ Download Linux library
        uses: actions/download-artifact@v4
        with:
          name: c-library-linux
          path: tmp/c/
      - name: ğŸ“¥ Download macOS library
        uses: actions/download-artifact@v4
        with:
          name: c-library-macos
          path: tmp/c/
      # - name: ğŸ“¥ Download Windows library
      #   uses: actions/download-artifact@v4
      #   with:
      #     name: c-library-windows
      #     path: tmp/c/
      - name: ğŸ“¥ Download Linux CLI
        uses: actions/download-artifact@v4
        with:
          name: c-cli-linux
          path: tmp/c/
      - name: ğŸ“¥ Download macOS CLI
        uses: actions/download-artifact@v4
        with:
          name: c-cli-macos
          path: tmp/c/
      # - name: ğŸ“¥ Download Windows CLI
      #   uses: actions/download-artifact@v4
      #   with:
      #     name: c-cli-windows
      #     path: tmp/c/
      - name: ğŸ“¥ Download Debian package
        uses: actions/download-artifact@v4
        with:
          name: c-debian-package
          path: tmp/c/
      - name: ğŸ“¥ Download Python wheels
        uses: actions/download-artifact@v4
        with:
          name: python-wheels
          path: tmp/python/dist/
      - name: ğŸ“¥ Download JVM JAR
        uses: actions/download-artifact@v4
        with:
          name: jvm-jar
          path: tmp/jvm/
      - name: ğŸ“¥ Download JVM sources JAR
        uses: actions/download-artifact@v4
        with:
          name: jvm-sources-jar
          path: tmp/jvm/
      - name: ğŸ“¥ Download JVM Javadoc JAR
        uses: actions/download-artifact@v4
        with:
          name: jvm-javadoc-jar
          path: tmp/jvm/
      - name: ğŸ“¥ Download JVM HTML docs JAR
        uses: actions/download-artifact@v4
        with:
          name: jvm-html-docs-jar
          path: tmp/jvm/
      - name: ğŸš€ Create GitHub release
        uses: softprops/action-gh-release@v2
        with:
          name: Release ${{ github.ref_name }}
          files: |
            tmp/c/*.so
            tmp/c/*.dylib
            tmp/c/*.dll
            tmp/c/tirex-tracker-*-Linux-*
            tmp/c/tirex-tracker-*-Darwin-*
            tmp/c/tirex-tracker-*-Linux.deb
            tmp/python/dist/*
            tmp/jvm/*/*.jar
          # files: |
          #   tmp/c/*.so
          #   tmp/c/*.dylib
          #   tmp/c/*.dll
          #   tmp/c/tirex-tracker-*-Linux-*
          #   tmp/c/tirex-tracker-*-Darwin-*
          #   tmp/c/tirex-tracker-*-Windows-*.exe
          #   tmp/c/tirex-tracker-*-Linux.deb
          #   tmp/python/dist/*
          #   tmp/jvm/*/*.jar
          fail_on_unmatched_files: true
          draft: false
          prerelease: false
          generate_release_notes: true
